KB 리포트 시스템 기술 명세서

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. 데이터 소스 및 수집 방법                                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 구분          │ 소스                    │ 수집방법              │ 업데이트주기    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ ETF 기본데이터│ 한국투자증권 ETF DB      │ pykrx 라이브러리      │ 일일 자동      │
│ 실시간 시세    │ 네이버금융, 한국투자증권  │ pykrx + 크롤링       │ 실시간        │
│ 뉴스/공시     │ 네이버뉴스, DART        │ BeautifulSoup + API   │ 일일 수집      │
│ 감정분석      │ OpenAI GPT-4            │ API 호출              │ 실시간        │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 2. ETF 점수 계산 시스템 (총점 100점)                                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 지표명              │ 기본가중치 │ APWL(적극적) │ IBMC(안정적) │ 계산방법        │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 수익률              │ 30%        │ 40%          │ 20%          │ 1년 수익률      │
│ 위험조정수익률      │ 25%        │ 30%          │ 25%          │ 샤프 비율       │
│ 비용효율성          │ 20%        │ 15%          │ 25%          │ 총보수율 역산   │
│ 유동성              │ 15%        │ 10%          │ 20%          │ 거래량 기준     │
│ 안정성              │ 10%        │ 5%           │ 10%          │ 변동성 역산     │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 3. 사용자 레벨별 위험등급 제한                                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 레벨 │ 설명        │ 최대위험등급 │ 추천특징                    │ 해석수준        │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 1    │ 초보자      │ 1           │ 안정적, 분산투자            │ 기초 용어 설명   │
│ 2    │ 입문자      │ 2           │ 성장성 + 안정성 균형        │ 일반적 설명     │
│ 3    │ 중급자      │ 3           │ 적극적 성장 투자            │ 전문적 분석     │
│ 4    │ 중상급자    │ 4           │ 고위험 고수익               │ 심화 분석       │
│ 5    │ 전문가      │ 4           │ 모든 투자 유형              │ 최고 수준 분석  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 4. 추천 엔진 필터링 프로세스                                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 단계 │ 필터링 조건                    │ 적용 방법                │ 결과            │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 1    │ 사용자 레벨 위험등급 제한      │ 레벨별 최대 위험등급     │ 위험도 적합 ETF │
│ 2    │ 관심 카테고리 키워드 검색       │ 반도체, 2차전지 등      │ 테마별 ETF      │
│ 3    │ WMTI 유형별 점수 정렬          │ 미리 계산된 점수 사용    │ 개인화 순위     │
│ 4    │ 상위 3개 선택                  │ 최고 점수 ETF 선택       │ 최종 추천       │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 5. MPTI 설명 스타일 적용                                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│ MPTI 유형    │ 설명특징                    │ 텍스트 변환 예시                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ Fact형       │ 객관적 사실 중심            │ "보였습니다" → "데이터로 확인되었습니다" │
│ Opinion형    │ 주관적 의견 포함            │ "~라고 판단됩니다" 추가              │
│ Intensive형  │ 핵심 정보 집중              │ 불필요한 설명 제거                  │
│ Extensive형  │ 다양한 관점 제시            │ "다양한 관점에서" 추가              │
│ Skimming형   │ 요약 중심                   │ 핵심 문장만 추출                    │
│ Perusing형   │ 상세 분석                   │ 추가 설명 및 예시 포함              │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 6. 리포트 구성 요소 및 데이터 흐름                                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 섹션명              │ 데이터소스              │ 표시내용              │ 개인화 요소    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 시장 개요           │ 네이버금융 크롤링       │ KOSPI, KOSDAQ, KTB10Y │ 레벨별 해석    │
│ 관심종목 시세       │ pykrx + 크롤링          │ 실시간 가격, 등락률   │ 하드코딩 종목  │
│ 뉴스 요약           │ 네이버뉴스 + GPT        │ 제목, 요약, 감정점수  │ MPTI 스타일    │
│ ETF 추천            │ 캐시 데이터             │ Top3, 분석, 이유     │ WMTI 점수      │
│ 포트폴리오 분석     │ pykrx ETF 구성          │ 구성종목 분포        │ 선택적 표시    │
│ 시세 비교 분석      │ 어제종목요약.py         │ 차트, 기술지표       │ 선택적 표시    │
│ 뉴스 감정분석       │ data_analysis.py        │ 상위종목 뉴스        │ 선택적 표시    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 7. 기술 스택 및 의존성                                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 카테고리    │ 기술/라이브러리              │ 용도                    │ 버전          │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 웹 프레임워크│ Streamlit                  │ UI/UX 구현              │ 최신          │
│ 데이터 처리  │ pandas, numpy              │ 데이터 분석 및 처리      │ 최신          │
│ 한국 주식    │ pykrx                      │ ETF/주식 데이터 수집     │ 최신          │
│ 웹 크롤링    │ BeautifulSoup, requests    │ 뉴스/시세 크롤링        │ 최신          │
│ AI/ML        │ OpenAI GPT-4               │ 감정분석, 텍스트 생성    │ 최신          │
│ 시각화       │ plotly, matplotlib         │ 차트 및 그래프          │ 최신          │
│ 환경관리     │ python-dotenv              │ API 키 관리             │ 최신          │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 8. 파일 구조 및 모듈 역할                                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 파일 경로                    │ 주요 기능                    │ 핵심 메서드/클래스    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ app/daily_report_app.py      │ 메인 Streamlit 앱            │ DailyReportApp      │
│ chatbot/config.py            │ 설정 및 상수 정의            │ Config, WMTI_WEIGHTS │
│ chatbot/recommendation_engine.py│ ETF 추천 로직              │ RecommendationEngine │
│ scripts/generate_etf_cache.py│ ETF 점수 캐시 생성           │ ETFScoreGenerator   │
│ scripts/calculate_risk_tier.py│ 위험등급 계산               │ RiskTierCalculator  │
│ news_analyzer.py             │ 뉴스/시세 수집               │ NewsAnalyzer        │
│ dart_api/main.py             │ DART 공시 처리               │ DARTProcessor       │
│ data/ETF_시세_데이터_*.csv   │ ETF 기본 데이터              │ 캐시 파일           │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 9. 성능 최적화 및 오류 처리                                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 최적화 영역        │ 적용 방법                    │ 효과                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 캐싱 전략          │ ETF 점수 사전 계산           │ API 호출 최소화        │
│ 데이터 백업        │ 일일 자동 백업               │ 데이터 손실 방지       │
│ 오류 복구          │ 대체 데이터 소스 사용        │ 서비스 연속성 보장     │
│ API 제한 관리      │ 호출 빈도 제한               │ 비용 최적화            │
│ 메모리 최적화      │ 데이터 청크 단위 처리        │ 메모리 사용량 감소     │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 10. 보안 및 개인정보 보호                                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 보안 영역          │ 적용 방법                    │ 보호 대상              │
├─────────────────────────────────────────────────────────────────────────────────┤
│ API 키 관리        │ 환경변수 사용                │ OpenAI, DART API 키    │
│ 데이터 암호화      │ 민감 정보 암호화 저장        │ 사용자 개인정보        │
│ 접근 권한          │ 파일 시스템 권한 제한        │ 데이터 파일            │
│ 로그 관리          │ 민감 정보 로그 제외          │ 시스템 로그            │
│ 네트워크 보안      │ HTTPS 통신 강제              │ API 통신               │
└─────────────────────────────────────────────────────────────────────────────────┘ 